\documentclass[12pt]{article}

\usepackage{amsmath}

\input{../../tex/preamble.tex}

\begin{document}
\makemytitlepage{2}{Обработка изображений на GPU. Фильтры.}

\se{Цель работы}

Научиться использовать GPU для обработки изображений.
Использование текстурной памяти.

\textbf{Вариант 6.} Выделение контуров. Метод Превитта(Прюитта).

\textbf{Входные данные.} На первой строке задается путь к исходному изображению,
на второй, путь к конечному изображению. $w*h <= 10^8$

\nvidia

\se{Метод решения}

Метод Превитта основан на обработке всех пикселей изображения двумя ядрами 3x3,
которые сворачивают изображение, вычисляя приблизительные производные:
одну по горизонтали, другую по вертикали.

\[
	G_x = \begin{bmatrix}
		-1 & -1 & -1 \\
		0  & 0  & 0  \\
		1  & 1  & 1
	\end{bmatrix},
	G_y = \begin{bmatrix}
		-1 & 0 & 1 \\
		-1 & 0 & 1 \\
		-1 & 0 & 1
	\end{bmatrix}
\]

Чтобы получить значение градиента в точке достаточно взять среднеквадратичное значение градиентов по $x$ и $y$.

\[
	G=\sqrt{G_x^2+G_y^2}
\]

\se{Описание программы}
Единственный файл \lstinline|main.cu|.

По условиям лабораторной используется текстурная ссылка для хранения пикселей.
Единственное ядро использует двумерную сетку потоков и обрабатывает отдельные пиксели.
Значение градиента записывается в результирующий массив типа \lstinline|uchar4|.

{
\scriptsize
\listsource{../src}{main.cu}
}

\newpage

\se{Результаты}

\textit{Время указано в миллисекундах}

Размеры изображения: 1634x2224

\begin{figure}[!ht]
	\begin{subfigure}{0.45\textwidth}
		\caption*{Исходное изображение}
		\includegraphics[scale=0.4]{../test/images/gopher.png}
	\end{subfigure}
	\begin{subfigure}{0.45\textwidth}
		\caption*{Результат:}
		\includegraphics[scale=0.1]{../test/t5/res.png}
	\end{subfigure}
\end{figure}


\begin{center}
	cpu time = 348.877649
	\begin{table*}[!htb]
		\centering
		\begin{tabular}{|c|c|c|}
			\hline
			blocks    & threads & time        \\
			\hline
			16x16     & 16x16   & 005.450240  \\
			32x32     & 16x16   & 005.528064  \\
			8x8       & 8x8     & 005.688256  \\
			16x16     & 32x32   & 005.862272  \\
			64x64     & 16x16   & 005.932992  \\
			32x32     & 32x32   & 006.667456  \\
			4x4       & 4x4     & 021.764448  \\
			1024x1024 & 16x16   & 031.003839  \\
			1024x1024 & 32x32   & 204.964478  \\
			1x1       & 1x1     & 3699.413574 \\
			\hline
		\end{tabular}
	\end{table*}
\end{center}


\se{Выводы}

Я понял что обрабатывать изображения на CPU плохая идея, если даже на одном небольшом изображении
разница получилась в 64 раза.

Конкретно выделение контуров было мне нужно для подготовки данных для обучения нейросети.
Нужно было разделить изображение на несколько по указанным линиям.
Правда там я использовал повышение контраста и резкости,
но чувствую было бы проще если бы я использовал предназначенный для этого алгоритм.

\end{document}